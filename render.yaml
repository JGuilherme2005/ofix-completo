services:
  # BACKEND SERVICE
  - type: web
    name: ofix-backend
    env: node
    plan: free
    rootDir: ofix_new/ofix-backend
    # Render typically sets NODE_ENV=production; ensure Prisma CLI (devDependency) is present at build time.
    # NOTE: Do not run Prisma migrations during build (DB may be unavailable); run at startup instead.
    buildCommand: npm ci --include=dev && npx prisma generate
    startCommand: npm start
    envVars:
      - key: NODE_VERSION
        value: 20.14.0
      - key: DATABASE_URL
        sync: false # Configure no painel (ex: Supabase pooler + ?pgbouncer=true&sslmode=require)
      - key: DIRECT_DATABASE_URL
        sync: false # Configure no painel (ex: Supabase direct + ?sslmode=require)
      - key: REDIS_URL
        sync: false # Usuário deve configurar no painel
      - key: AGNO_API_URL
        value: http://matias-agno:7777
      - key: AGNO_API_TOKEN
        sync: false # Deve ser o MESMO valor de OS_SECURITY_KEY no servico matias-agno
      - key: AGNO_PUBLIC_AGENT_ID
        value: matias-public
      - key: JWT_SECRET
        sync: false # Gere uma senha segura e coloque aqui

  # MATIAS AGNO SERVICE
  - type: web
    name: matias-agno
    env: docker
    plan: free
    rootDir: matias_agnoV1
    dockerfilePath: Dockerfile
    envVars:
      - key: PORT
        value: 7777
      - key: OS_SECURITY_KEY
        sync: false # Obrigatorio em producao (AgentOS exige Authorization: Bearer <OS_SECURITY_KEY>)
      - key: OPENAI_API_KEY
        sync: false
      - key: GROQ_API_KEY
        sync: false
      - key: HF_TOKEN
        sync: false
      - key: OLLAMA_ENABLED
        value: true
      - key: OLLAMA_BASE_URL
        sync: false # Usuário deve colar sua URL do Ngrok aqui
